<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClusterFlux Projects</title>
    <link rel="icon" type="image/svg+xml" href="logo.svg">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://homepage.theclusterflux.com/">
    <meta property="og:title" content="ClusterFlux Projects">
    <meta property="og:description" content="A showcase of innovative projects built by TheClusterFlux community. Explore our collection of web applications, tools, and creative solutions.">
    <meta property="og:image" content="https://homepage.theclusterflux.com/logo.png">
    <meta property="og:site_name" content="ClusterFlux">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://homepage.theclusterflux.com/">
    <meta property="twitter:title" content="ClusterFlux Projects">
    <meta property="twitter:description" content="A showcase of innovative projects built by TheClusterFlux community. Explore our collection of web applications, tools, and creative solutions.">
    <meta property="twitter:image" content="https://homepage.theclusterflux.com/logo.png">
    
    <!-- Additional meta tags -->
    <meta name="description" content="A showcase of innovative projects built by TheClusterFlux community. Explore our collection of web applications, tools, and creative solutions.">
    <meta name="keywords" content="ClusterFlux, projects, web development, open source, community">
    <meta name="author" content="TheClusterFlux">
    
    <link rel="stylesheet" href="style-guilty-crown.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
</head>
<body>

<header class="header">
  <div class="header-content">
    <div class="header-brand">
      <img src="logo.svg" alt="ClusterFlux" class="site-logo">
      <h1 class="site-title">ClusterFlux Projects</h1>
    </div>
    
    <div class="header-controls">
      <div class="search-filter-container">
        <div class="search-container">
          <i class="fas fa-search search-icon"></i>
          <input
            type="text"
            id="search-bar"
            class="search-bar"
            placeholder="Search projects by title or tech..."
          />
        </div>
        
        <div id="filter-container" class="filter-container">
          <label for="creator-filter"><i class="fas fa-user-filter"></i> Filter Author:</label>
          <select id="creator-filter">
            <option value="all">All Creators</option>
          </select>
        </div>
      </div>
      
      <div class="header-buttons">
        <button id="theme-toggle" class="action-button" title="Toggle Dark Mode">
          <i class="fas fa-moon" id="theme-icon"></i>
          <span id="theme-text">Dark</span>
        </button>
        <button id="about-button" class="action-button about-button" title="About Us">
          <i class="fas fa-info-circle"></i>
          <span>About</span>
        </button>
        <a href="https://github.com/TheClusterFlux" target="_blank" class="action-button github-button" title="GitHub">
          <i class="fab fa-github"></i>
          <span>GitHub</span>
        </a>
      </div>
    </div>
  </div>
</header>

<!-- Featured Projects Section -->
<div id="featured-projects-section" class="featured-projects-section" style="display: none;">
  <h2 class="featured-section-title">
    <i class="fas fa-star"></i> Featured Projects
  </h2>
  <div id="featured-projects" class="projects-grid featured-grid"></div>
</div>

<div id="all-projects-section">
  <h2 class="all-projects-title">All Projects</h2>
  <div id="projects" class="projects-grid"></div>
</div>

<div id="creators" class="creators-footer">
  <h2>Creators</h2>
  <div id="creators-list" class="creators-buttons"></div>
</div>


<script>
  // Dynamically determine base URL based on environment
  const baseURL = '';  // Use empty string for relative URLs
    
  // Fetch creators and populate the filter and creators section

  function fetchCreators() {
    fetch(`${baseURL}/data/creators.json`)
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP error ${response.status}`);
        }
        return response.json();
      })
      .then(creators => {
        const filter = document.getElementById('creator-filter');
        const creatorsList = document.getElementById('creators-list');
        creatorsList.innerHTML = ''; // Clear existing creators
        
        // Clear existing filter options except "All Creators"
        filter.innerHTML = '<option value="all">All Creators</option>';

        creators.forEach(creator => {
          // Add to filter dropdown
          const option = document.createElement('option');
          option.value = creator.name;
          option.textContent = creator.name;
          filter.appendChild(option);

          // Add to creators section
          const listItem = document.createElement('li');
          listItem.innerHTML = `<a href="${creator.github}" target="_blank">${creator.name}</a>`;
          creatorsList.appendChild(listItem);
        });
      })
      .catch(error => console.error('Error fetching creators:', error));
  }

  // Filter projects based on the selected creator
  document.getElementById('creator-filter').addEventListener('change', (event) => {
    const selectedCreator = event.target.value;
    const projectCards = document.querySelectorAll('#projects .card');
    const featuredCards = document.querySelectorAll('#featured-projects .card');

    // Filter regular projects
    projectCards.forEach(card => {
      const author = card.querySelector('.author').textContent.replace('Author: ', '');
      if (selectedCreator === 'all' || author === selectedCreator) {
        card.style.display = 'block';
      } else {
        card.style.display = 'none';
      }
    });
    
    // Filter featured projects
    featuredCards.forEach(card => {
      const author = card.querySelector('.author').textContent.replace('Author: ', '');
      if (selectedCreator === 'all' || author === selectedCreator) {
        card.style.display = 'block';
      } else {
        card.style.display = 'none';
      }
    });
  });
  // Helper function to create a project card HTML
  function createProjectCard(project) {
    const hasImage = project.image && project.image.trim() !== '';
    const imageElement = hasImage 
      ? `<img src="${baseURL}/thumbnails/${project.image}" alt="${project.title}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">`
      : '';
    const constructionIcon = hasImage 
      ? `<div class="construction-placeholder" style="display: none;">
           <i class="fas fa-tools"></i>
           <span>Card Under Construction</span>
         </div>`
      : `<div class="construction-placeholder">
           <i class="fas fa-tools"></i>
           <span>Card Under Construction</span>
         </div>`;

    return `
      <div class="card">
        ${imageElement}
        ${constructionIcon}
        <div class="card-body">
          <h5>${project.title}</h5>
          <p>${project.description}</p>
          <div class="tech-list">Tech: ${project.tech}</div>
          <p class="author">Author: ${project.author}</p>
          <div class="project-links">
            ${Object.entries(project.links || {})
              .map(
                ([key, url]) =>
                  `<a href="${url}" class="btn" target="_blank">${key}</a>`
              )
              .join(' ')}
          </div>
        </div>
      </div>
    `;
  }

  function fetchProjects() {
    fetch(`${baseURL}/data/projects.json`)
      .then(response => response.json())
      .then(projects => {
        // Separate featured and regular projects
        const featuredProjects = projects.filter(project => project.featured === true || project.featured === 'true');
        const regularProjects = projects.filter(project => !project.featured || (project.featured !== true && project.featured !== 'true'));
        
        // Sort featured projects (prioritize those with visit links, then alphabetically)
        featuredProjects.sort((a, b) => {
          const aHasVisitLink = Object.keys(a.links || {}).some(key => 
            key.toLowerCase() === 'visit' || key.toLowerCase() === 'website' || key.toLowerCase() === 'demo');
          const bHasVisitLink = Object.keys(b.links || {}).some(key => 
            key.toLowerCase() === 'visit' || key.toLowerCase() === 'website' || key.toLowerCase() === 'demo');
          
          if (aHasVisitLink && !bHasVisitLink) return -1;
          if (!aHasVisitLink && bHasVisitLink) return 1;
          return a.title.localeCompare(b.title);
        });
        
        // Sort regular projects
        regularProjects.sort((a, b) => {
          const titleComparison = a.title.localeCompare(b.title);
          const aHasVisitLink = Object.keys(a.links || {}).some(key => 
            key.toLowerCase() === 'visit' || key.toLowerCase() === 'website' || key.toLowerCase() === 'demo');
          const bHasVisitLink = Object.keys(b.links || {}).some(key => 
            key.toLowerCase() === 'visit' || key.toLowerCase() === 'website' || key.toLowerCase() === 'demo');
          
          if (aHasVisitLink && !bHasVisitLink) return -1;
          if (!aHasVisitLink && bHasVisitLink) return 1;
          return titleComparison;
        });
        
        // Display featured projects
        const featuredContainer = document.getElementById('featured-projects');
        const featuredSection = document.getElementById('featured-projects-section');
        
        if (featuredProjects.length > 0) {
          featuredSection.style.display = 'block';
          featuredContainer.innerHTML = '';
          featuredProjects.forEach(project => {
            featuredContainer.innerHTML += createProjectCard(project);
          });
        } else {
          featuredSection.style.display = 'none';
        }
        
        // Display regular projects
        const container = document.getElementById('projects');
        container.innerHTML = '';
        regularProjects.forEach(project => {
          container.innerHTML += createProjectCard(project);
        });
      })
      .catch(error => console.error('Error fetching projects:', error));
  }

  // Dark Mode Toggle
  const themeToggle = document.getElementById('theme-toggle');
  const themeIcon = document.getElementById('theme-icon');
  const themeText = document.getElementById('theme-text');
  
  // Check for saved theme preference or default to light mode
  const currentTheme = localStorage.getItem('theme') || 'light';
  document.documentElement.setAttribute('data-theme', currentTheme);
  updateThemeIcon(currentTheme);
  
  function updateThemeIcon(theme) {
    if (theme === 'dark') {
      themeIcon.classList.remove('fa-moon');
      themeIcon.classList.add('fa-sun');
      themeText.textContent = 'Light';
    } else {
      themeIcon.classList.remove('fa-sun');
      themeIcon.classList.add('fa-moon');
      themeText.textContent = 'Dark';
    }
  }
  
  themeToggle.addEventListener('click', () => {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    updateThemeIcon(newTheme);
  });

  // Initialize the page
  fetchCreators();
  fetchProjects();

  // Filter projects based on the search input
  document.getElementById('search-bar').addEventListener('input', (event) => {
    const searchTerm = event.target.value.toLowerCase();
    const projectCards = document.querySelectorAll('#projects .card');
    const featuredCards = document.querySelectorAll('#featured-projects .card');

    // Filter regular projects
    projectCards.forEach((card) => {
      const title = card.querySelector('h5').textContent.toLowerCase();
      const tech = card.querySelector('.tech-list').textContent.toLowerCase();

      if (title.includes(searchTerm) || tech.includes(searchTerm)) {
        card.style.display = 'block';
      } else {
        card.style.display = 'none';
      }
    });
    
    // Filter featured projects
    featuredCards.forEach((card) => {
      const title = card.querySelector('h5').textContent.toLowerCase();
      const tech = card.querySelector('.tech-list').textContent.toLowerCase();

      if (title.includes(searchTerm) || tech.includes(searchTerm)) {
        card.style.display = 'block';
      } else {
        card.style.display = 'none';
      }
    });
  });

  // Navigate to About page
  document.getElementById('about-button').addEventListener('click', () => {
    window.location.href = '/about.html';
  });


  closeCreatorModalButton.addEventListener('click', () => {
    addCreatorModal.classList.add('hidden');
  });

</script>

</body>
</html>